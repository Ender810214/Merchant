unit Sel_prod_alm;

interface

uses
  Winapi.Windows, Winapi.Messages, System.SysUtils, System.Variants, System.Classes, Vcl.Graphics,
  Vcl.Controls, Vcl.Forms, Vcl.Dialogs, CurvyControls, cxGraphics, cxControls,
  cxLookAndFeels, cxLookAndFeelPainters, cxStyles,  cxCustomData, cxFilter, cxData,
  cxDataStorage, cxEdit, cxNavigator, Data.DB, cxDBData, cxDBNavigator,
  cxGridCustomTableView, cxGridTableView, cxGridDBTableView, MemDS, DBAccess,
  Uni, AdvSmoothButton, cxGridLevel, cxClasses, cxGridCustomView, cxGrid,
  Vcl.Buttons, cxDataControllerConditionalFormattingRulesManagerDialog,
  dxDateRanges;

type
  TFSel_Prod_Alm = class(TForm)
    CurvyPanel1: TCurvyPanel;
    cxGrid1DBTableView1: TcxGridDBTableView;
    cxGrid1Level1: TcxGridLevel;
    cxGrid1: TcxGrid;
    CurvyPanel2: TCurvyPanel;
    AdvSmoothButton1: TAdvSmoothButton;
    AdvSmoothButton2: TAdvSmoothButton;
    cxDBNavigator1: TcxDBNavigator;
    UniQuery1: TUniQuery;
    DataSource2: TDataSource;
    cxGrid1DBTableView1precio_cup: TcxGridDBColumn;
    cxGrid1DBTableView1codigo_producto: TcxGridDBColumn;
    cxGrid1DBTableView1descripcion_producto: TcxGridDBColumn;
    cxGrid1DBTableView1existencia: TcxGridDBColumn;
    cxGrid1DBTableView1anexo: TcxGridDBColumn;
    cxGrid1DBTableView1posicion_anexo: TcxGridDBColumn;
    cxGrid1DBTableView1codcontrato: TcxGridDBColumn;
    cxGrid1DBTableView1codcliente: TcxGridDBColumn;
    UniQuery1ubicacionid: TIntegerField;
    UniQuery1existencia: TFloatField;
    UniQuery1contratoid: TIntegerField;
    UniQuery1clienteid: TIntegerField;
    UniQuery1codcontrato: TStringField;
    UniQuery1codcliente: TStringField;
    UniQuery1productoid: TIntegerField;
    UniQuery1almacenid: TStringField;
    UniQuery1precio_cup: TFloatField;
    UniQuery1codigo_producto: TStringField;
    UniQuery1descripcion_producto: TStringField;
    UniQuery1precio_usd: TFloatField;
    UniQuery1anexo: TIntegerField;
    UniQuery1posicion_anexo: TIntegerField;
    UniQuery1costo_unitario: TFloatField;
    cxGrid1DBTableView1costo_unitario: TcxGridDBColumn;
    cxGrid1DBTableView1precio_usd: TcxGridDBColumn;
    UniQuery1reservado: TFloatField;
    UniStoredProc1: TUniStoredProc;
    UniQuery1ueb: TStringField;
    cxGrid1DBTableView1ueb: TcxGridDBColumn;
    UniStoredProc2: TUniStoredProc;
    procedure AdvSmoothButton1Click(Sender: TObject);
    procedure AdvSmoothButton2Click(Sender: TObject);
    procedure FormShow(Sender: TObject);
  private
    { Private declarations }
  public
    { Public declarations }
  end;

var
  FSel_Prod_Alm: TFSel_Prod_Alm;

implementation
 uses main, prod_fact,facturas;
{$R *.dfm}

procedure TFSel_Prod_Alm.AdvSmoothButton1Click(Sender: TObject);
begin
UniStoredProc1.ParamByName('in_contrato').Value:=UniQuery1contratoid.Value;
UniStoredProc1.ParamByName('in_cliente').Value:=UniQuery1clienteid.Value;
UniStoredProc1.ParamByName('in_anexo').Value:=UniQuery1anexo.Value;
UniStoredProc1.ParamByName('in_posicion').Value:=UniQuery1posicion_anexo.Value;
UniStoredProc1.ParamByName('in_ubicacion').Value:=UniQuery1ubicacionid.Value;
UniStoredProc1.ParamByName('in_producto').Value:=UniQuery1productoid.Value;
UniStoredProc1.ExecSQL;
UniQuery1.Refresh;
Fprod_fact.QProd_Factcontratoid.Value:=UniQuery1contratoid.Value;
Fprod_fact.QProd_Factclienteid.Value:=UniQuery1clienteid.Value;
Fprod_fact.QProd_Factproductoid.Value:=UniQuery1productoid.Value;
Fprod_fact.QProd_Factalmacenid.Value:=UniQuery1almacenid.Value;
Fprod_fact.QProd_Factubicacionid.Value:=UniQuery1ubicacionid.Value;
Fprod_fact.QProd_Factcantidad_factura.Value:=UniQuery1existencia.Value;
Fprod_fact.QProd_Factanexoid.value:=UniQuery1anexo.Value;
Fprod_fact.QProd_Factposicion_anexo.value:=UniQuery1posicion_anexo.Value;
vreservado:=UniQuery1reservado.Value;

vdisponible:=UniQuery1existencia.Value-vreservado;
Fprod_fact.Label9.Caption:=floattostr(vdisponible);



  Close;
end;

procedure TFSel_Prod_Alm.AdvSmoothButton2Click(Sender: TObject);
begin
close;
end;

procedure TFSel_Prod_Alm.FormShow(Sender: TObject);
begin
UniQuery1.ParamByName('contrato').Value:=Ffacturas.UniQuery2contratoid.Value;
UniQuery1.ParamByName('cliente').Value:=Ffacturas.UniQuery2clienteid.Value;
UniQuery1.ExecSQL;
UniQuery1.Open;
end;

end.
